<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmet Store</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .controls { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .product { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pagination { margin-top: 20px; text-align: center; }
        button { padding: 8px 15px; cursor: pointer; }
        input, select { padding: 8px; margin-right: 10px; }
    </style>
</head>
<body>

    <h1>üèçÔ∏è Helmet Store</h1>
    
    <div class="controls">
        <input type="text" id="search-input" placeholder="Search helmets..." oninput="resetAndLoad()">
        
        <select id="category-select" onchange="resetAndLoad()">
            <option value="">All Categories</option>
            <option value="Racing">Racing</option>
            <option value="Street">Street</option>
            <option value="Off-Road">Off-Road</option>
            <option value="Touring">Touring</option>
            <option value="Modular">Modular</option>
            <option value="Bicycle">Bicycle</option>
        </select>

        <select id="sort-select" onchange="loadProducts()">
            <option value="name">Sort by Name</option>
            <option value="price_asc">Price: Low to High</option>
            <option value="price_desc">Price: High to Low</option>
        </select>
    </div>

    <div id="product-list"></div>

    <div class="pagination">
        <button id="prev-btn" onclick="changePage(-1)">Previous</button>
        <span id="page-info" style="margin: 0 15px; font-weight: bold;">Page 1</span>
        <button id="next-btn" onclick="changePage(1)">Next</button>
    </div>

    <script>
        let currentPage = 1; 
        const limit = 3;     // Shows 3 items per page so you can test the buttons

        // Helper to reset to page 1 when searching/filtering
        function resetAndLoad() {
            currentPage = 1;
            loadProducts();
        }

        async function loadProducts() {
            const search = document.getElementById('search-input').value;
            const category = document.getElementById('category-select').value;
            const sort = document.getElementById('sort-select').value;

            // Build the URL with all parameters
            const url = `/api/products?search=${search}&category=${category}&sort=${sort}&page=${currentPage}&limit=${limit}`;

            try {
                const response = await fetch(url);
                const data = await response.json(); 

                // 1. Get the list of products from the data package
                const products = data.products; 

                const container = document.getElementById('product-list');
                container.innerHTML = '';

                if (products.length === 0) {
                    container.innerHTML = '<p>No helmets found.</p>';
                } else {
                    products.forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'product';
                        div.innerHTML = `
                            <h3>${product.name}</h3>
                            <p><strong>Category:</strong> ${product.category}</p>
                            <p><strong>Price:</strong> $${product.price}</p>
                            <p>Stock: ${product.stock}</p>
                        `;
                        container.appendChild(div);
                    });
                }

                // 2. Update Page Buttons
                document.getElementById('page-info').innerText = `Page ${data.page} of ${data.pages}`;
                document.getElementById('prev-btn').disabled = data.page <= 1;
                document.getElementById('next-btn').disabled = data.page >= data.pages;

            } catch (err) {
                console.error('Error loading products:', err);
            }
        }

        function changePage(step) {
            currentPage += step;
            loadProducts();
        }

        // Run on startup
        loadProducts();
    </script>

</body>
</html>